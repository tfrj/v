<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø³ØªÙ„Ù…</title>
    <style>
        /* ØªØµÙ…ÙŠÙ… Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠ Ù„Ù„Ø¬ÙˆØ§Ù„ */
        body { 
            font-family: sans-serif; 
            background: #000; 
            color: white; 
            margin: 0; 
            overflow: hidden; 
            display: flex; 
            flex-direction: column; 
            height: 100vh; 
        }
        .header { 
            padding: 15px; 
            background: rgba(20, 20, 20, 0.9); 
            text-align: center; 
            font-weight: bold; 
            border-bottom: 1px solid #333;
            z-index: 10;
        }
        #playerContainer { 
            flex-grow: 1; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            background: #000;
        }
        video, iframe { 
            width: 100%; 
            height: 100%; 
            border: none; 
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }
        .status-bar { 
            position: fixed; 
            bottom: 10px; 
            width: 100%; 
            text-align: center; 
            font-size: 12px; 
            color: #555; 
        }
        .overlay-msg {
            color: #888;
            font-size: 18px;
            text-align: center;
        }
    </style>
</head>
<body>

<div class="header">ğŸ“º Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©</div>

<div id="playerContainer">
    <div class="overlay-msg">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø« Ø£ÙŠ ÙÙŠØ¯ÙŠÙˆ...</div>
</div>

<div class="status-bar">Ù…ØªØµÙ„ Ø¨Ù€ Firebase - ØªØ­Ø¯ÙŠØ« Ù„Ø­Ø¸ÙŠ</div>

<script type="module">
    // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Firebase Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø± (CDN)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
    const firebaseConfig = {
        apiKey: "AIzaSyAjTD-OJBUYewp5bqV0iVh4Rxp5zjBsU54",
        authDomain: "videos-5e336.firebaseapp.com",
        databaseURL: "https://videos-5e336-default-rtdb.firebaseio.com",
        projectId: "videos-5e336",
        storageBucket: "videos-5e336.firebasestorage.app",
        messagingSenderId: "300218651134",
        appId: "1:300218651134:web:4bd24df8e555e62828f0af"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const videoRef = ref(db, 'sharedVideo');

    // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø£ÙŠ ØªØºÙŠÙŠØ± ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·
    onValue(videoRef, (snapshot) => {
        const data = snapshot.val();
        if (data && data.url) {
            renderPlayer(data.url);
        }
    });

    function renderPlayer(url) {
        const container = document.getElementById('playerContainer');
        
        // 1. Ø¥Ø°Ø§ ÙƒØ§Ù† Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ Ù…Ø¨Ø§Ø´Ø± (MP4, etc.)
        if (url.match(/\.(mp4|webm|mov|m4v|ogg)$/i)) {
            container.innerHTML = `
                <video id="mainVideo" controls autoplay playsinline name="media">
                    <source src="${url}" type="video/mp4">
                    Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ.
                </video>`;
        } 
        // 2. Ø¥Ø°Ø§ ÙƒØ§Ù† Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨
        else if (url.includes("youtube.com") || url.includes("youtu.be")) {
            let videoId = "";
            if (url.includes("v=")) {
                videoId = url.split('v=')[1].split('&')[0];
            } else {
                videoId = url.split('/').pop();
            }
            container.innerHTML = `
                <iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen></iframe>`;
        }
        // 3. Ø£ÙŠ Ø±Ø§Ø¨Ø· Ø¢Ø®Ø± ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙƒÙ…Ø´ØºÙ„ (ÙŠØ¹Ø±Ø¶Ù‡ ÙƒØ±Ø§Ø¨Ø·)
        else {
            container.innerHTML = `
                <div style="text-align:center">
                    <p>Ø±Ø§Ø¨Ø· ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… Ù„Ù„Ù…Ø´ØºÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±:</p>
                    <a href="${url}" target="_blank" style="color:#007bff; font-size:20px;">Ø¥Ø¶ØºØ· Ù‡Ù†Ø§ Ù„ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¯ÙˆÙŠØ§Ù‹</a>
                </div>`;
        }
    }
</script>

</body>
</html>
